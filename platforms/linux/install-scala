#!/bin/bash

# --------------------------------------------------
#  Installing Scala
# --------------------------------------------------
echo "Installing Scala..."

wget http://www.scala-lang.org/sites/default/files/linuxsoft_archives/downloads/distrib/files/scala-2.9.0.1.tgz
if [ $? -ne 0 ]; then
  echo "Scala: Failed to download package, please check package name."
  exit 1
fi

tar -xvf scala-2.9.0.1.tgz
rm scala-2.9.0.1.tgz
sudo mv scala-2.9.0.1 /usr/lib/scala-2.9.0.1
sudo ln -s /usr/lib/scala-2.9.0.1 /usr/lib/scala
sudo ln -s /usr/lib/scala-2.9.0.1/bin/scala /usr/bin/scala
sudo ln -s /usr/lib/scala-2.9.0.1/bin/scalac /usr/bin/scalac

echo '' | tee -a ~/.profile
echo '# Added by Scala Install' | tee -a ~/.profile
echo 'export PATH="/usr/lib/scala/bin:$PATH"' | tee -a ~/.profile
echo 'export SCALA_HOME="/usr/lib/scala"' | tee -a ~/.profile

# --------------------------------------------------
#  Setup Scala-Upgrade
# --------------------------------------------------
echo "Setting up upgradescala..."

mkdir ~/.local

echo '#!/bin/sh' | tee -a ~/.local/scala-upgrade.sh

echo '' | tee -a ~/.local/scala-upgrade.sh
echo 'read -p "Please enter the version number you wish to upgrade to:" version' | tee -a ~/.local/scala-upgrade.sh

echo '' | tee -a ~/.local/scala-upgrade.sh
echo 'wget http://www.scala-lang.org/sites/default/files/linuxsoft_archives/downloads/distrib/files/scala-$version.tgz' | tee -a ~/.local/scala-upgrade.sh
echo 'if [ $? -ne 0 ]; then' | tee -a ~/.local/scala-upgrade.sh
echo '  echo "Scala: Failed to download package, please check package name."' | tee -a ~/.local/scala-upgrade.sh
echo '  exit 1' | tee -a ~/.local/scala-upgrade.sh
echo 'fi' | tee -a ~/.local/scala-upgrade.sh

echo '' | tee -a ~/.local/scala-upgrade.sh
echo 'tar -xvf scala-$version.tgz' | tee -a ~/.local/scala-upgrade.sh
echo 'rm scala-$version.tgz' | tee -a ~/.local/scala-upgrade.sh

echo '' | tee -a ~/.local/scala-upgrade.sh
echo 'sudo mv scala-$version /usr/lib/scala-$version' | tee -a ~/.local/scala-upgrade.sh
echo 'sudo rm /usr/bin/scala' | tee -a ~/.local/scala-upgrade.sh
echo 'sudo rm /usr/bin/scalac' | tee -a ~/.local/scala-upgrade.sh
echo 'sudo rm /usr/lib/scala' | tee -a ~/.local/scala-upgrade.sh
echo 'sudo ln -s /usr/lib/scala-$version/bin/scala /usr/bin/scala' | tee -a ~/.local/scala-upgrade.sh
echo 'sudo ln -s /usr/lib/scala-$version/bin/scalac /usr/bin/scalac' | tee -a ~/.local/scala-upgrade.sh
echo 'sudo ln -s /usr/lib/scala-$version /usr/lib/scala' | tee -a ~/.local/scala-upgrade.sh

echo '' | tee -a ~/.local/scala-upgrade.sh
echo 'if [ $?=0 ]' | tee -a ~/.local/scala-upgrade.sh
echo 'then echo "Scala: upgraded"' | tee -a ~/.local/scala-upgrade.sh
echo 'else' | tee -a ~/.local/scala-upgrade.sh
echo '  echo "Scala: failed"' | tee -a ~/.local/scala-upgrade.sh
echo '  exit 1' | tee -a ~/.local/scala-upgrade.sh
echo 'fi' | tee -a ~/.local/scala-upgrade.sh

echo 'alias upgradescala="~/.local/scala-upgrade.sh"' | tee -a ~/.bash_aliases

chmod 755 ~/.local/scala-upgrade.sh

if [ $?=0 ]
then echo "Scala: installed"
else
  echo "Scala: failed"
  exit 1
fi

